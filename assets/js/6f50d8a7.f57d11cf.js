"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[480],{12(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"vulnerabilities/arithmetic-overflow","title":"02 - Arithmetic Overflow","description":"Analysis","source":"@site/docs/vulnerabilities/02-arithmetic-overflow.md","sourceDirName":"vulnerabilities","slug":"/vulnerabilities/arithmetic-overflow","permalink":"/bytesUnchecked/docs/vulnerabilities/arithmetic-overflow","draft":false,"unlisted":false,"editUrl":"https://github.com/nathfavour/bytesUnchecked/tree/main/docs/docs/vulnerabilities/02-arithmetic-overflow.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"01 - Missing Signer","permalink":"/bytesUnchecked/docs/vulnerabilities/missing-signer"},"next":{"title":"03 - PDA Metadata Leak","permalink":"/bytesUnchecked/docs/vulnerabilities/pda-seed-leak"}}');var i=n(4848),s=n(8453);const o={},a="02 - Arithmetic Overflow",c={},l=[{value:"Analysis",id:"analysis",level:2},{value:"Exploit (Insecure)",id:"exploit-insecure",level:2},{value:"Fix (Secure)",id:"fix-secure",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"02---arithmetic-overflow",children:"02 - Arithmetic Overflow"})}),"\n",(0,i.jsx)(t.h2,{id:"analysis",children:"Analysis"}),"\n",(0,i.jsxs)(t.p,{children:["Arithmetic overflows and underflows occur when a mathematical operation results in a value that exceeds the maximum or minimum limit of the data type (e.g., ",(0,i.jsx)(t.code,{children:"u64"}),"). In older versions of Rust or when ",(0,i.jsx)(t.code,{children:"overflow-checks"}),' are disabled, these operations "wrap around."']}),"\n",(0,i.jsxs)(t.p,{children:["In a financial context, an underflow (e.g., ",(0,i.jsx)(t.code,{children:"0 - 1"}),") could result in a massive balance (",(0,i.jsx)(t.code,{children:"2^64 - 1"}),"), while an overflow (e.g., ",(0,i.jsx)(t.code,{children:"max + 1"}),") could reset a user's funds to zero."]}),"\n",(0,i.jsx)(t.h2,{id:"exploit-insecure",children:"Exploit (Insecure)"}),"\n",(0,i.jsxs)(t.p,{children:["The insecure version uses the standard addition operator ",(0,i.jsx)(t.code,{children:"+"}),". While modern Anchor projects usually enable overflow checks by default in ",(0,i.jsx)(t.code,{children:"Cargo.toml"}),", relying on compiler flags rather than explicit logic is dangerous."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-rust",children:"pub fn deposit_insecure(ctx: Context<UpdateVault>, amount: u64) -> Result<()> {\n    let vault = &mut ctx.accounts.vault;\n    //  If overflow-checks are off, this wraps.\n    // If they are on, it panics the program, which is better but still unhandled.\n    vault.balance += amount;\n    Ok(())\n}\n"})}),"\n",(0,i.jsx)(t.h2,{id:"fix-secure",children:"Fix (Secure)"}),"\n",(0,i.jsxs)(t.p,{children:["The secure implementation uses Rust's ",(0,i.jsx)(t.code,{children:"checked_*"})," methods or Anchor's ",(0,i.jsx)(t.code,{children:"math"})," features to handle errors gracefully."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-rust",children:"pub fn deposit_secure(ctx: Context<UpdateVault>, amount: u64) -> Result<()> {\n    let vault = &mut ctx.accounts.vault;\n    //  Use checked_add to return an explicit error on overflow.\n    vault.balance = vault.balance.checked_add(amount)\n        .ok_or(error!(ErrorCode::Overflow))?;\n    Ok(())\n}\n"})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>o,x:()=>a});var r=n(6540);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);